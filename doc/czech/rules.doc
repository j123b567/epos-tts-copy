
Soubor s pravidly lze urèit v inicializaèních souborech, implicitnì
se pou¾ije cfg/default.rul (kdo ví jestli)


Syntax øádku s pravidlem:
-------------------------

Vyskytuje-li se na øádku znak '#' nebo ';', ve¹kerý text od nìj
a¾ do konce øádku se ignoruje jako¾to komentáø. Pokud u¾ nic
jiného na øádku nezbývá, øádek se pova¾uje za prázdný a ignoruje se.

Ka¾dý neprázdný øádek musí obsahovat 2-4 slova oddìlená mezerami
(anebo definici skupiny, viz Skupiny):

Typ_pravidla  Parametr  Rozsah  Zasa¾ená_jednotka

Není-li uveden rozsah, pou¾ije se WORD, není-li uvedena zasa¾ená
jednotka, pou¾ije se PHONE. Typ_pravidla, Rozsah a Zasa¾ená_jednotka
mohou být zapsány jak velkými, tak malými písmeny, ale Parametr
je vìt¹inou na velikost písmen citlivý.

Rozsah (napø. WORD):  jednotka, pøes její¾ hranice pravidlo nepùsobí
Zasa¾ená jednotka:    manipulovaná jednotka, typicky hláska (PHONE)
                      Musí být men¹í ne¾ rozsah tého¾ pravidla.

Typ_pravidla SUBST:   parametr obsahuje jméno slovníku, v nìm¾ se budou
                      vyhledávat ekvivalenty. Zasa¾ená jednotka musí být
                      hláska. Zkou¹ejí se v¹echny podøetìzce (nejdel¹í
                      napøed), dokud není ekvivalent nalezen. 
                      Ten by mìl nahradit pøíslu¹nou èást slova.
                      Dal¹í informace viz doc/dict.doc
                      
Typ_pravidla REGEX:   substituce za regulární výraz. Vysvìtlení, proè
                      ho nezkoumat a nepou¾ívat, je v anglické dokumentaci.

Typ_pravidla PREP:    toté¾, jako SUBST, ale místo metody M_SUBSTR
                      se pou¾ívá M_EXACT (slovník musí obsahovat
                      nikoli libovolný podøetìzec, ale pøímo hledanou
                      jednotku) a dojde-li k nalezení a pøípadnému 
                      nahrazení danému hashovací tabulkou pojmenovanou
                      parametrem, pøipojí se obsah zasa¾ené jednotky 
                      na zaèátek jejího pravého souseda a ona sama
                      je vyøazena. (Nemá-li souseda, nic se nestane.)
                      
Typ_pravidla POSTP:   analogický s PREP, ale obsah zasa¾ených jednotek
                      se pøipojuje na konec souseda zleva.                      
                      
                      PREP a POSTP nejsou toté¾, co pøedlo¾ky
                      a nepøízvuèné pøíklonky, ale je praktické 
                      si to myslet.

Typ_pravidla RAISE:   Pøesun hlásky (resp. jejího symbolu) nebo jiné
                      jednotky do vy¹¹í úrovnì. U¾ívá se zejména,
                      pokud segmentální jednotky pøímo ovlivòují
                      suprasegmentalia, jako tøeba rozdìlení otázek
                      na zji¹»ovací a doplòovací.
                      
                      Parametr je tvaru co-cestuje:kdy_cestuje
                      (tedy napø. "q:?!" znamená, ¾e znak q
                      nahradí otazník nebo vykøièník ve v¹ech
                      otazníkových a vykøièníkových vìtách, které
                      obsahují "q". (Kopie "q" na hláskové rovinì
                      ale zùstává. Pozor na rozsah pravidla.)
                      co-cestuje i kdy-cestuje nemusí být jednotlivé
                      znaky, mohou to být napø. øetìzce pou¾ívající
                      operátor "vyjma" (viz ní¾e).
                      
                      Rozsah pravidla je úroveò, kde mù¾e dojít
                      ke zmìnì (ponìkud nelogické), v uvedeném
                      pøípadì vìta; zasa¾ená jednotka je úroveò,
                      ze které mohou znaky vyjít, v uvedeném pøípadì
                      hláska.
                      
Typ_pravidla REGRESS  Zmìna hlásek èi jiných jednotek podle jejich
                      bezprostøedního okolí.
                      
                      Parametr pravidel PROGRESS a REGRESS je tvaru
                      co-se-mìní>na-co(levé-okolí_pravé-okolí)
                      (tedy napø. "ptk>bdg(aeiou_aeiou)" oznìlí
                      uvedené intervokalické explozívy.
                      Zmìna se vyhodnocuje zprava doleva.

                      Zmìní-li se jednotka na hodnotu DELETE_ME
                      (momentálnì '0'), sama se ihned zru¹í;
                      obsahuje-li jiné jednotky, zaniknou rovnì¾.
                      
                      Seznam "na co" mù¾e být tvoøen jediným znakem.
                      V tom pøípadì se pøedpokládá, ¾e se v daném 
                      okolí mìní v¹echny jednotky "co se mìní" 
                      na tento znak. Jinak musí být poèet znakù
                      na obou stranách '>' stejný a znaky se mìní
                      na znaky s odpovídajícím poøadím v "na co".
                      
                      Seznam "co se mìní" mù¾e té¾ obsahovat znak
                      JUNCTURE (nyní '0'). V takovém pøípadì mezi
                      jednotkami danými levým a pravým okolím
                      vznikne jedna nová jednotka s obsahem daným
                      pøíslu¹nou polo¾kou seznamu "na co".
                      
                      Levé i pravé okolí mohou té¾ obsahovat symbol
                      JUNCTURE (nyní '0') pro oznaèení pøedìlu úrovnì,
                      je¾ tvoøí rozsah pravidla. V literatuøe se 
                      k tìmto úèelùm èasto pou¾ívá symbol '#'.

		      Tìmito pravidly není mo¾no obrábìt '0' jako¾to
		      znak vyskytující se v textu; takový znak se
		      nikdy nemìní. K jeho zpracování je nutno
		      sáhnout po pravidlu napø. typu SUBST nebo REGEX.

Typ_pravidla PROGRESS Jako REGRESS, ale zmìna se vyhodnocuje zleva.

                      REGRESS a PROGRESS nejsou toté¾, co regresívní
                      a progresívní fonetická zmìna, ale je praktické
                      si to myslet.
                      
Typ_pravidla SYLL     Zjednodu¹enì øeèeno, stanoví slabièné hranice 
                      podle teorie sonority. Parametr je tvaru
                      nejménì-sonorní<více-sonorní<je¹tì-více...
                      (tedy napø. "0<pk»t<bdïg<mnòN<lr<iu<aeo"),
                      neuvedené hlásky se pova¾ují za nejménì sonorní
                      a v rámci ka¾dé skupiny na poøadí nezále¾í.

                      Pøíklady pro parametr "0<c<n<r<v" (znakem '|'
                      vyznaèuji novì vlo¾enou slabiènou hranici):
                      v|cv  vc|cv  vc|ccccv  vrc|c  vr|crv  v|cn|cv  
                      
                      Podrobnosti viz unit::syllabify ve zdrojáku.
                      
                      Poznámka: vý¹e uvedené platí, je-li jako rozsah
                      pravidla uvedena slabika, co¾ je v tomto pøípadì
                      implicitní hodnota. Zasa¾ená jednotka je samozøejmì
                      hláska. Pro jiné kombinace jsem to neladil, ale
                      principielnì to jde zobecnit.
                      
Typ_pravidla PROSODY  Mìní hodnoty velièin F,I,T pro jednotlivé jednotky.
                      Parametr obsahuje jméno slovníku obsahujícího 
                      pøíslu¹ná pravidla. Jejich formát viz doc/prosody.doc

Typ_pravidla CONTOUR  Mìní hodnoty velièin F,I,T pro celé lineární sekvence
		      jednotek naráz.
		      Parametr je tvaru velièina/hodn:hodn:hodn atd.,
		      to jest F, I nebo T a seznam hodnot postupnì pøiøazených
		      zasa¾eným jednotkám v rámci rozsahu.

		      V pøimìøené míøe je syntax obdobná syntaxi pravidla
		      SMOOTH.
                      
Typ_pravidla SMOOTH   Vyhlazuje stanovenou velièinu F,I nebo T. Parametr
		      je tvaru velièina/levé_váhy/váha_pùvodního\pravé_váhy
		      (tedy napø. "f/10/20/40\20\10"; levé váhy se tedy
		      mezi sebou oddìlují lomítkem, pravé váhy obráceným
		      lomítkem, první písmeno urèuje velièinu).
		      
		      Nová hodnota velièiny pro ka¾dou zasa¾enou jednotku
		      se poèítá jako vá¾ený prùmìr hodnot velièin okolních
		      jednotek: v uvedeném pøípadu jsou váha pùvodní
		      hodnoty velièiny 40%, sousedi mají váhu po 20%, 
		      sousedi ob jednoho mají váhu 10%, vzdálenìj¹í nic.
		      
		      Pokud je jednotka pøíli¹ blízko okraje rozsahu,
		      tak¾e pøíslu¹nì vzdáleného souseda nìkterým smìrem
		      ani nemá, uva¾uje se místo nìj hodnota velièiny
		      v krajní jednotce v rozsahu pøíslu¹ným smìrem.
		      
		      Syntax je benevolentní. Váha nemusí být pouze
		      pevné èíslo, mù¾e být té¾ rozepsána jako souèet
		      èi rozdíl více èísel a mù¾e být záporná.
		      
		      Pøi aplikaci tohoto pravidla se projektují
		      v¹echny velièiny do roviny hlásek (snad).
		      Co to znamená, bych mìl tady nìkdy vysvìtlit.

Typ_pravidla DIPHONES Vytvoøí pod vrstvou hlásek vrstvu difonù.
                      Parametr je jméno souboru s èísly difonù,
                      hrubý popis lze nalézt v doc/difony.doc
                      
                      Zasa¾ená jednotka je to, co hraje roli hlásek,
                      nikoli difonù; vytváøené jednotky jsou v¾dy
                      úrovnì difon (v paranoidní kompilaci tedy
                      nelze mìnit zasa¾enou jednotku).
                      
                      Mìnit rozsah je naopak vhodné (default je WORD).
                      
Typ_pravidla DEBUG    Poskytuje ladící tisky bìhem aplikace pravidel,
                      hodí se tedy pro ladìní souboru s pravidly.  
                      Tento typ pravidel je mnohem ménì blbovzdorný,
                      ne¾ vìt¹ina jiných èástí programu. Rozsah
                      a zasa¾ená jednotka se ignorují.

                      Obsahuje-li parametr podøetìzec "elem", vypí¹e se 
                      momentální stav zpracovávaného textu. 
                      
                      Obsahuje-li parametr podøetìzec "rule" resp. 
                      "rules", vypí¹e se následující pravidlo, které 
                      se bude aplikovat, resp. v¹echna pravidla vùbec.
                      Od verze 1.4 nefunguje.
                      
                      Obsahuje-li parametr podøetìzec "pause", vyèká
                      program stisku klávesy.
                      
Typ_pravidla INSIDE   Provede následující pravidlo nebo blok pravidel
                      (viz ní¾e) jen pro ty èásti textu, které mají
                      na úrovni odpovídající rozsahu jednotku s obsahem
                      vyskytujícím se v parametru.
                      
                      Parametrem je tedy seznam hodnot, pøi kterých
                      se následující pravidlo (obvykle blok) provádí.
                      
                      Ka¾dá jednotka (napøíklad vìta), která splní
                      podmínku, je dále zpracována zvlá¹», tak¾e
                      pravidlo následující po INSIDE smí mít rozsah
                      nanejvý¹ stejný jako pravidlo INSIDE.
                      
Typ_pravidla WITH     Provede následující pravidlo nebo blok pravidel
                      jen pro ty èásti textu, které jsou shodné
                      s nìkterou polo¾kou slovníku urèenou parametrem.
                      
                      Parametrem je tedy slovník (napøíklad výèet
                      urèitých slovních tvarù, je-li rozsahem slovo).

                      Stejnì jako u pravidla INSIDE nesmí být rozsah
                      podøízeného pravidla vìt¹í ne¾ rozsah pravidla WITH.

                      
Typ_pravidla IF       Provede následující pravidlo nebo blok pravidel
                      tehdy, je-li nastaven parametr hlasu (typu boolean)
                      urèený parametrem pravidla. Pøed názvem konfiguraèního
                      parametru mù¾e být vykøièník, který neguje jeho hodnotu.

                      Stejnì jako u pravidla INSIDE nesmí být rozsah
                      podøízeného pravidla vìt¹í ne¾ rozsah pravidla IF.

                      Stejnì jako u blokù (viz ní¾e) dìdí pravidlo IF
                      maximální mo¾ný rozsah od svého nadøazeného pravidla,
                      není-li uveden.
                      


Skupiny
-------

Øádek mù¾e mít té¾ formát    "$identifikátor=skupina", kde
    znak '$' musí stát v prvním sloupci øádku
    rovnítko mohou doprovázet mezery èi tabelátory
    skupina nesmí obsahovat mezeru èi tabelátor
Tím se zavede identifikátor, kterým je nadále mo¾no skupinu oznaèovat.
Máme-li tedy napøíklad definováno, ¾e

$bum  =  ptk

mù¾eme psát ekvivalentnì 

Ka¾urská_asimilace   progress  ptk>sss(aei_s)   word  phone
Ka¾urská_asimilace   progress  $bum>sss(aei_s)  word  phone

Je té¾ mo¾no definice skupin vnoøovat, tedy napø.
$voiceless = sf$bum
definuje skupinu obsahující hlásky s,f,p,t,k. Je pøípustné mìnit døíve 
pøiøazené nebo vestavìné hodnoty.

Mohou-li vzniknout pochybnosti o ukonèení identifikátoru skupiny, 
lze pou¾ít oddìlovaè '&' nebo ':' nebo umístit identifikátor do slo¾ených
závorek, tedy napø.

Spodoba_znìlosti  regress  $voiced>${voiceless}($all_$voiceless&0)  word phone

Mimoto je mo¾no importovat definici skupiny z konfiguraèních parametrù,
a to pomocí "$identifikátor external", pøièem¾ znak '$' musí opìt stát
v prvním sloupci øádku:

$language  external

kde "language" musí být konfiguraèní parametr, jeho hodnota bude stanovena
podle .ini souborù. Pozdìj¹í redefinice $language se ale nepromítne zpìt do
konfigurace.

Definice skupiny platí v¾dy do konce bloku, v nìm¾ se vyskytuje (obvykle
se uvádí na zaèátku pravidel a platí tedy v celém textu pravidel), anebo
do následující definice skupiny s tímté¾ identifikátorem


Operátor "vyjma"
----------------

Pøi udávání levého a pravého okolí, kde nastává zmìna, lze pou¾ít 
operátor "vyjma", reprezentovaný vykøièníkem. Tak¾e napø. v pravidle

Asimilace_znìlosti   regress  $voiceless>$voiced($all_$voiced!v)

nedojde ke spodobì ve slovì "kvùli". Pokud navíc vykøièníku nic
nepøedchází, jde o skupinu obsahující v¹echny znaky kromì znakù
za vykøièníkem; samotný vykøièník tudí¾ znamená "v¾dy":

Asimilace_znìlosti   regress  $voiceless>$voiced(!_$voiced!v)

Vykøièníky je té¾ mo¾né støídat. Chceme-li tedy zapsat "Souhlásky, vyjma 
tøených, ale znìlé i neznìlé ø zase ano", mìlo by fungovat "$cons!$fric!øØ".

Vykøièníky ov¹em nemají tento speciální význam v první èásti pravidla
"co se mìní na co".


Zvlá¹tní znaky chápané doslova
------------------------------

Je-li potøeba pou¾ít vykøièník jako znak, lze si jeho doslovné chápání
vynutit zpìtným lomítkem, jako v "inside  ?\!." (otazník, vykøièník,
teèka). Je-li potøeba pou¾ít zpìtné lomítko jako znak, musí být zdvojeno.

Podobným zpùsobem je mo¾no pou¾ívat jako znaky i mezeru (jindy ukonèuje
parametr pravidla), støedník (jinak zaèátek komentáøe) a podobnì, tj.
napøíklad "regress   \ >~(!_!)   colon" zmìní v rámci ka¾dého promluvového
úseku v¹echny mezery na vlnovky. Kdyby nìkdo potøeboval znak nového øádku
èi tabelátor, mù¾e pou¾ít "\n", "\t".

Jinými slovy, zpìtné lomítko ru¹í zvlá¹tní funkci následujícího znaku.


Preprocessor
------------

Øádek

#include "soubor.rul"

(zaèínající skuteènì v krajním levém sloupci) se pøi naèítání souboru
s pravidly nahradí textem ze souboru soubor.rul. Ten mù¾e opìt obsahovat
dal¹í vnoøené direktivy #include, prakticky do neomezené hloubky.
Direktiva

#warn nìjaký text

vypí¹e "nìjaký text" pøi naèítání pravidel. Zatím není k u¾itku.

Jiné direktivy (øádky zaèínající znakem '#') se ignorují, vzhledem 
k tomu, ¾e zároveò vypadají jako øádek obsahující jen komentáø.
Proto se napø. mezera pøed nebo za znakem '#' projeví tichým
ignorováním posti¾ené direktivy.


Bloky pravidel
--------------

Blok pravidel zaèíná levou slo¾enou závorkou na samostatném øádku,
konèí pravou slo¾enou závorkou na samostatném øádku. Pou¾ívá se
obvykle v kombinaci s podmínìným pravidlem:

IF  .:  sent
{
	...
	...
}

Proto¾e pravidlo IF podmiòuje následující pravidlo, a následující
pravidlo je blok, provedou se postupnì v¹echna pravidla v bloku,
a to pro ka¾dou oznamovací vìtu zvlá¹». (Jiné ne¾ oznamovací vìty
nesplní tuto konkrétní podmínku.)

Blok mù¾e mít té¾ uveden rozsah, implicitnì ho v¹ak dìdí od svého
nadøazeného pravidla (napøíklad podmínky nebo jiného bloku).
Rozsah urèuje, na jak velké jednotky se pøi aplikaci rozdìlí
zpracovávaný text, analogicky s jinými pravidly.

Jsou-li v bloku definovány jakékoli skupiny, platí jejich identi-
fikátor pouze do konce bloku, tzn. je "lokální".

Jen pro úplnost: pøed pravidlo umístìné v bloku lze udat, kolikrát
se má opakovat:
{
	...
	2x  smooth  f/30/40\30	phone
}
Poèet opakování musí být pøirozené èíslo bezprostøednì následované
znakem "x". Tuto pasá¾ dokumentace nemáme rádi.


Náhodné volby
-------------

Mezi hranaté závorky je mo¾no zapsat nìkolik pravidel:

[
	prosody		typical.dic
	prosody		variant.dic
]

Pøi provádìní tìchto pravidel se náhodnì vybere jedno z nich
a provede se. V¹echno se chová stejnì jako u blokù, a¾ na to,
¾e se neprovádìjí v¹echna pravidla, ale jen jedno, náhodnì
zvolené.

Náhodná volba se koná zvlá¹» pro ka¾dou zpracovávanou jednotku
(její¾ úroveò popisu je shodná s rozsahem hranatých závorek).

Je-li potøeba pou¾ívat rùzné mo¾nosti rùznì èasto, je mo¾no
uvést váhy takto:

[
	3x prosody		typical.dic
	   prosody		variant.dic
]

V tomto pøíkladu se v 75% pøípadù pou¾ije první mo¾nost,
v 25% pøípadù druhá. Váha musí být kladné pøirozené èíslo.

(Je-li váha analogicky pou¾ita v bloku, pravidlo se bude
tolikrát opakovat.)


Výbìr pravidel podle poètu jednotek podøízených jednotce
--------------------------------------------------------

Nìkdy je potøeba odli¹nì o¹etøovat napøíklad dvojslabièné,
trojslabièné a víceslabièné takty. Pak lze pøíslu¹ná
pravidla uzavøít mezi ¹pièaté závorky:

<  word syll
	nothing
	contour		f/+2:-3
	contour		f/+2:-2:+1
	nothing
>

První pravidlo "nothing" zde uvádí, ¾e jednoslabièná slova
se neo¹etøují, koncové slovo "nothing" uvádí, ¾e ètyø-
a víceslabièná slova se neo¹etøují. Pokud toti¾ nadøazená
jednotka (úrovnì rozsahu) obsahuje více zasa¾ených jednotek,
ne¾ pro kolik je uvedeno pravidlo, pou¾ije se poslední
uvedené pravidlo. Pokud by tedy koncové pravidlo "nothing"
chybìlo, pou¾ilo by se pøedcházející pravidlo i pro del¹í
ne¾ trojslabièné takty.

Jako u blokù a náhodných voleb, i zde je mo¾né uvádìt,
kolikrát se má identické pravidlo poèítat. Upravíme-li
tedy pøedchozí pøíklad takto ---

<  word syll
	nothing
	contour		f/+2:-3
    2x	contour		f/+2:-2:+1
	nothing
>

--- pou¾ije se druhé uvedené pravidlo "contour" pro slova
tøíslabièná a ètyøslabièná.

