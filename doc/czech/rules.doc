
Soubor s pravidly lze urèit v inicializaèních souborech, implicitnì
se pouije cfg/default.rul (kdo ví jestli)


Syntax øádku s pravidlem:
-------------------------

Vyskytuje-li se na øádku znak '#' nebo ';', veškerı text od nìj
a do konce øádku se ignoruje jakoto komentáø. Pokud u nic
jiného na øádku nezbıvá, øádek se povauje za prázdnı a ignoruje se.

Kadı neprázdnı øádek musí obsahovat 2-4 slova oddìlená mezerami
(anebo definici skupiny, viz Skupiny):

Typ_pravidla  Parametr  Rozsah  Zasaená_jednotka

Není-li uveden rozsah, pouije se WORD, není-li uvedena zasaená
jednotka, pouije se PHONE. Typ_pravidla, Rozsah a Zasaená_jednotka
mohou bıt zapsány jak velkımi, tak malımi písmeny, ale Parametr
je vìtšinou na velikost písmen citlivı.

Rozsah (napø. WORD):  jednotka, pøes její hranice pravidlo nepùsobí
Zasaená jednotka:    manipulovaná jednotka, typicky hláska (PHONE)
                      Musí bıt menší ne rozsah tého pravidla.

Typ_pravidla SUBST:   parametr obsahuje jméno slovníku, v nìm se budou
                      vyhledávat ekvivalenty. Zasaená jednotka musí bıt
                      hláska. Zkoušejí se všechny podøetìzce (nejdelší
                      napøed), dokud není ekvivalent nalezen. 
                      Ten by mìl nahradit pøíslušnou èást slova.
                      Další informace viz doc/dict.doc
                      
Typ_pravidla REGEX:   substituce za regulární vıraz. Vysvìtlení, proè
                      ho nezkoumat a nepouívat, je v anglické dokumentaci.

Typ_pravidla PREP:    toté, jako SUBST, ale místo metody M_SUBSTR
                      se pouívá M_EXACT (slovník musí obsahovat
                      nikoli libovolnı podøetìzec, ale pøímo hledanou
                      jednotku) a dojde-li k nalezení a pøípadnému 
                      nahrazení danému hashovací tabulkou pojmenovanou
                      parametrem, pøipojí se obsah zasaené jednotky 
                      na zaèátek jejího pravého souseda a ona sama
                      je vyøazena. (Nemá-li souseda, nic se nestane.)
                      
Typ_pravidla POSTP:   analogickı s PREP, ale obsah zasaenıch jednotek
                      se pøipojuje na konec souseda zleva.                      
                      
                      PREP a POSTP nejsou toté, co pøedloky
                      a nepøízvuèné pøíklonky, ale je praktické 
                      si to myslet.

Typ_pravidla RAISE:   Pøesun hlásky (resp. jejího symbolu) nebo jiné
                      jednotky do vyšší úrovnì. Uívá se zejména,
                      pokud segmentální jednotky pøímo ovlivòují
                      suprasegmentalia, jako tøeba rozdìlení otázek
                      na zjišovací a doplòovací.
                      
                      Parametr je tvaru co-cestuje:kdy_cestuje
                      (tedy napø. "q:?!" znamená, e znak q
                      nahradí otazník nebo vykøièník ve všech
                      otazníkovıch a vykøièníkovıch vìtách, které
                      obsahují "q". (Kopie "q" na hláskové rovinì
                      ale zùstává. Pozor na rozsah pravidla.)
                      co-cestuje i kdy-cestuje nemusí bıt jednotlivé
                      znaky, mohou to bıt napø. øetìzce pouívající
                      operátor "vyjma" (viz níe).
                      
                      Rozsah pravidla je úroveò, kde mùe dojít
                      ke zmìnì (ponìkud nelogické), v uvedeném
                      pøípadì vìta; zasaená jednotka je úroveò,
                      ze které mohou znaky vyjít, v uvedeném pøípadì
                      hláska.
                      
Typ_pravidla REGRESS  Zmìna hlásek èi jinıch jednotek podle jejich
                      bezprostøedního okolí.
                      
                      Parametr pravidel PROGRESS a REGRESS je tvaru
                      co-se-mìní>na-co(levé-okolí_pravé-okolí)
                      (tedy napø. "ptk>bdg(aeiou_aeiou)" oznìlí
                      uvedené intervokalické explozívy.
                      Zmìna se vyhodnocuje zprava doleva.

                      Zmìní-li se jednotka na hodnotu DELETE_ME
                      (momentálnì '0'), sama se ihned zruší;
                      obsahuje-li jiné jednotky, zaniknou rovnì.
                      
                      Seznam "na co" mùe bıt tvoøen jedinım znakem.
                      V tom pøípadì se pøedpokládá, e se v daném 
                      okolí mìní všechny jednotky "co se mìní" 
                      na tento znak. Jinak musí bıt poèet znakù
                      na obou stranách '>' stejnı a znaky se mìní
                      na znaky s odpovídajícím poøadím v "na co".
                      
                      Seznam "co se mìní" mùe té obsahovat znak
                      JUNCTURE (nyní '0'). V takovém pøípadì mezi
                      jednotkami danımi levım a pravım okolím
                      vznikne jedna nová jednotka s obsahem danım
                      pøíslušnou polokou seznamu "na co".
                      
                      Levé i pravé okolí mohou té obsahovat symbol
                      JUNCTURE (nyní '0') pro oznaèení pøedìlu úrovnì,
                      je tvoøí rozsah pravidla. V literatuøe se 
                      k tìmto úèelùm èasto pouívá symbol '#'.

		      Tìmito pravidly není mono obrábìt '0' jakoto
		      znak vyskytující se v textu; takovı znak se
		      nikdy nemìní. K jeho zpracování je nutno
		      sáhnout po pravidlu napø. typu SUBST nebo REGEX.

Typ_pravidla PROGRESS Jako REGRESS, ale zmìna se vyhodnocuje zleva.

                      REGRESS a PROGRESS nejsou toté, co regresívní
                      a progresívní fonetická zmìna, ale je praktické
                      si to myslet.
                      
Typ_pravidla SYLL     Zjednodušenì øeèeno, stanoví slabièné hranice 
                      podle teorie sonority. Parametr je tvaru
                      nejménì-sonorní<více-sonorní<ještì-více...
                      (tedy napø. "0<pkt<bdïg<mnòN<lr<iu<aeo"),
                      neuvedené hlásky se povaují za nejménì sonorní
                      a v rámci kadé skupiny na poøadí nezáleí.

                      Pøíklady pro parametr "0<c<n<r<v" (znakem '|'
                      vyznaèuji novì vloenou slabiènou hranici):
                      v|cv  vc|cv  vc|ccccv  vrc|c  vr|crv  v|cn|cv  
                      
                      Podrobnosti viz unit::syllablify ve zdrojáku.
                      
                      Poznámka: vıše uvedené platí, je-li jako rozsah
                      pravidla uvedena slabika, co je v tomto pøípadì
                      implicitní hodnota. Zasaená jednotka je samozøejmì
                      hláska. Pro jiné kombinace jsem to neladil, ale
                      principielnì to jde zobecnit.
                      
Typ_pravidla PROSODY  Mìní hodnoty velièin F,I,T pro jednotlivé jednotky.
                      Parametr obsahuje jméno slovníku obsahujícího 
                      pøíslušná pravidla. Jejich formát viz doc/prosody.doc

Typ_pravidla CONTOUR  Mìní hodnoty velièin F,I,T pro celé lineární sekvence
		      jednotek naráz.
		      Parametr je tvaru velièina/hodn:hodn:hodn atd.,
		      to jest F, I nebo T a seznam hodnot postupnì pøiøazenıch
		      zasaenım jednotkám v rámci rozsahu.

		      V pøimìøené míøe je syntax obdobná syntaxi pravidla
		      SMOOTH.
                      
Typ_pravidla SMOOTH   Vyhlazuje stanovenou velièinu F,I nebo T. Parametr
		      je tvaru velièina/levé_váhy/váha_pùvodního\pravé_váhy
		      (tedy napø. "f/10/20/40\20\10"; levé váhy se tedy
		      mezi sebou oddìlují lomítkem, pravé váhy obrácenım
		      lomítkem, první písmeno urèuje velièinu).
		      
		      Nová hodnota velièiny pro kadou zasaenou jednotku
		      se poèítá jako váenı prùmìr hodnot velièin okolních
		      jednotek: v uvedeném pøípadu jsou váha pùvodní
		      hodnoty velièiny 40%, sousedi mají váhu po 20%, 
		      sousedi ob jednoho mají váhu 10%, vzdálenìjší nic.
		      
		      Pokud je jednotka pøíliš blízko okraje rozsahu,
		      take pøíslušnì vzdáleného souseda nìkterım smìrem
		      ani nemá, uvauje se místo nìj hodnota velièiny
		      v krajní jednotce v rozsahu pøíslušnım smìrem.
		      
		      Syntax je benevolentní. Váha nemusí bıt pouze
		      pevné èíslo, mùe bıt té rozepsána jako souèet
		      èi rozdíl více èísel a mùe bıt záporná.
		      
		      Pøi aplikaci tohoto pravidla se projektují
		      všechny velièiny do roviny hlásek (snad).
		      Co to znamená, bych mìl tady nìkdy vysvìtlit.

Typ_pravidla DIPHONES Vytvoøí pod vrstvou hlásek vrstvu difonù.
                      Parametr je jméno souboru s èísly difonù,
                      hrubı popis lze nalézt v doc/difony.doc
                      
                      Zasaená jednotka je to, co hraje roli hlásek,
                      nikoli difonù; vytváøené jednotky jsou vdy
                      úrovnì difon (v paranoidní kompilaci tedy
                      nelze mìnit zasaenou jednotku).
                      
                      Mìnit rozsah je naopak vhodné (default je WORD).
                      
Typ_pravidla DEBUG    Poskytuje ladící tisky bìhem aplikace pravidel,
                      hodí se tedy pro ladìní souboru s pravidly.  
                      Tento typ pravidel je mnohem ménì blbovzdornı,
                      ne vìtšina jinıch èástí programu. Rozsah
                      a zasaená jednotka se ignorují.

                      Obsahuje-li parametr podøetìzec "elem", vypíše se 
                      momentální stav zpracovávaného textu. 
                      
                      Obsahuje-li parametr podøetìzec "rule" resp. 
                      "rules", vypíše se následující pravidlo, které 
                      se bude aplikovat, resp. všechna pravidla vùbec.
                      Od verze 1.4 nefunguje.
                      
                      Obsahuje-li parametr podøetìzec "pause", vyèká
                      program stisku klávesy.
                      
Typ_pravidla INSIDE   Provede následující pravidlo nebo blok pravidel
                      (viz níe) jen pro ty èásti textu, které mají
                      na úrovni odpovídající rozsahu jednotku s obsahem
                      vyskytujícím se v parametru.
                      
                      Parametrem je tedy seznam hodnot, pøi kterıch
                      se následující pravidlo (obvykle blok) provádí.
                      
                      Kadá jednotka (napøíklad vìta), která splní
                      podmínku, je dále zpracována zvláš, take
                      pravidlo následující po INSIDE smí mít rozsah
                      nanejvıš stejnı jako pravidlo INSIDE.
                      
Typ_pravidla WITH     Provede následující pravidlo nebo blok pravidel
                      jen pro ty èásti textu, které jsou shodné
                      s nìkterou polokou slovníku urèenou parametrem.
                      
                      Parametrem je tedy slovník (napøíklad vıèet
                      urèitıch slovních tvarù, je-li rozsahem slovo).

                      Stejnì jako u pravidla INSIDE nesmí bıt rozsah
                      podøízeného pravidla vìtší ne rozsah pravidla WITH.

                      
Typ_pravidla IF       Provede následující pravidlo nebo blok pravidel
                      tehdy, je-li splnìna podmínka daná parametrem.
                      
                      Parametr musí bıt tvaru string1=string2, kde
                      string1 a string2 jsou libovolné øetìzce a chápe
                      se jako test jejich rovnosti po substituci
                      za identifikátory skupin.
                      
                      Stejnì jako u pravidla INSIDE nesmí bıt rozsah
                      podøízeného pravidla vìtší ne rozsah pravidla IF.
                      


Skupiny
-------

Øádek mùe mít té formát    "$identifikátor=skupina", kde
    znak '$' musí stát v prvním sloupci øádku
    rovnítko mohou doprovázet mezery èi tabelátory
    skupina nesmí obsahovat mezeru èi tabelátor
Tím se zavede identifikátor, kterım je nadále mono skupinu oznaèovat.
Máme-li tedy napøíklad definováno, e

$bum  =  ptk

mùeme psát ekvivalentnì 

Kaurská_asimilace   progress  ptk>sss(aei_s)   word  phone
Kaurská_asimilace   progress  $bum>sss(aei_s)  word  phone

Je té mono definice skupin vnoøovat, tedy napø.
$voiceless = sf$bum
definuje skupinu obsahující hlásky s,f,p,t,k. Je pøípustné mìnit døíve 
pøiøazené nebo vestavìné hodnoty.

Mohou-li vzniknout pochybnosti o ukonèení identifikátoru skupiny, 
lze pouít oddìlovaè '&' nebo ':' nebo umístit identifikátor do sloenıch
závorek, tedy napø.

Spodoba_znìlosti  regress  $voiced>${voiceless}($all_$voiceless&0)  word phone

Mimoto je mono importovat definici skupiny z konfiguraèních parametrù,
a to pomocí "$identifikátor external", pøièem znak '$' musí opìt stát
v prvním sloupci øádku:

$language  external

kde "language" musí bıt konfiguraèní parametr, jeho hodnota bude stanovena
podle .ini souborù. Pozdìjší redefinice $language se ale nepromítne zpìt do
konfigurace.

Definice skupiny platí vdy do konce bloku, v nìm se vyskytuje (obvykle
se uvádí na zaèátku pravidel a platí tedy v celém textu pravidel), anebo
do následující definice skupiny s tímté identifikátorem


Operátor "vyjma"
----------------

Pøi udávání levého a pravého okolí, kde nastává zmìna, lze pouít 
operátor "vyjma", reprezentovanı vykøièníkem. Take napø. v pravidle

Asimilace_znìlosti   regress  $voiceless>$voiced($all_$voiced!v)

nedojde ke spodobì ve slovì "kvùli". Pokud navíc vykøièníku nic
nepøedchází, jde o skupinu obsahující všechny znaky kromì znakù
za vykøièníkem; samotnı vykøièník tudí znamená "vdy":

Asimilace_znìlosti   regress  $voiceless>$voiced(!_$voiced!v)

Vykøièníky je té moné støídat. Chceme-li tedy zapsat "Souhlásky, vyjma 
tøenıch, ale znìlé i neznìlé ø zase ano", mìlo by fungovat "$cons!$fric!øØ".

Vykøièníky ovšem nemají tento speciální vıznam v první èásti pravidla
"co se mìní na co".


Zvláštní znaky chápané doslova
------------------------------

Je-li potøeba pouít vykøièník jako znak, lze si jeho doslovné chápání
vynutit zpìtnım lomítkem, jako v "inside  ?\!." (otazník, vykøièník,
teèka). Je-li potøeba pouít zpìtné lomítko jako znak, musí bıt zdvojeno.

Podobnım zpùsobem je mono pouívat jako znaky i mezeru (jindy ukonèuje
parametr pravidla), støedník (jinak zaèátek komentáøe) a podobnì, tj.
napøíklad "regress   \ >~(!_!)   colon" zmìní v rámci kadého promluvového
úseku všechny mezery na vlnovky. Kdyby nìkdo potøeboval znak nového øádku
èi tabelátor, mùe pouít "\n", "\t".

Jinımi slovy, zpìtné lomítko ruší zvláštní funkci následujícího znaku.


Preprocessor
------------

Øádek

#include "soubor.rul"

(zaèínající skuteènì v krajním levém sloupci) se pøi naèítání souboru
s pravidly nahradí textem ze souboru soubor.rul. Ten mùe opìt obsahovat
další vnoøené direktivy #include, prakticky do neomezené hloubky.
Direktiva

#warn nìjakı text

vypíše "nìjakı text" pøi naèítání pravidel. Zatím není k uitku.

Jiné direktivy (øádky zaèínající znakem '#') se ignorují, vzhledem 
k tomu, e zároveò vypadají jako øádek obsahující jen komentáø.
Proto se napø. mezera pøed nebo za znakem '#' projeví tichım
ignorováním postiené direktivy.


Bloky pravidel
--------------

Blok pravidel zaèíná levou sloenou závorkou na samostatném øádku,
konèí pravou sloenou závorkou na samostatném øádku. Pouívá se
obvykle v kombinaci s podmínìnım pravidlem:

IF  .:  sent
{
	...
	...
}

Protoe pravidlo IF podmiòuje následující pravidlo, a následující
pravidlo je blok, provedou se postupnì všechna pravidla v bloku,
a to pro kadou oznamovací vìtu zvláš. (Jiné ne oznamovací vìty
nesplní tuto konkrétní podmínku.)

Blok mùe mít té uveden rozsah, implicitnì ho však dìdí od svého
nadøazeného pravidla (napøíklad podmínky nebo jiného bloku).
Rozsah urèuje, na jak velké jednotky se pøi aplikaci rozdìlí
zpracovávanı text, analogicky s jinımi pravidly.

Jsou-li v bloku definovány jakékoli skupiny, platí jejich identi-
fikátor pouze do konce bloku, tzn. je "lokální".

Jen pro úplnost: pøed pravidlo umístìné v bloku lze udat, kolikrát
se má opakovat:
{
	...
	2x  smooth  f/30/40\30	phone
}
Poèet opakování musí bıt pøirozené èíslo bezprostøednì následované
znakem "x". Tuto pasá dokumentace nemáme rádi.


Náhodné volby
-------------

Mezi hranaté závorky je mono zapsat nìkolik pravidel:

[
	prosody		typical.dic
	prosody		variant.dic
]

Pøi provádìní tìchto pravidel se náhodnì vybere jedno z nich
a provede se. Všechno se chová stejnì jako u blokù, a na to,
e se neprovádìjí všechna pravidla, ale jen jedno, náhodnì
zvolené.

Náhodná volba se koná zvláš pro kadou zpracovávanou jednotku
(její úroveò popisu je shodná s rozsahem hranatıch závorek).

Je-li potøeba pouívat rùzné monosti rùznì èasto, je mono
uvést váhy takto:

[
	3x prosody		typical.dic
	   prosody		variant.dic
]

V tomto pøíkladu se v 75% pøípadù pouije první monost,
v 25% pøípadù druhá. Váha musí bıt kladné pøirozené èíslo.

(Je-li váha analogicky pouita v bloku, pravidlo se bude
tolikrát opakovat.)


Vıbìr pravidel podle poètu jednotek podøízenıch jednotce
--------------------------------------------------------

Nìkdy je potøeba odlišnì ošetøovat napøíklad dvojslabièné,
trojslabièné a víceslabièné takty. Pak lze pøíslušná
pravidla uzavøít mezi špièaté závorky:

<  word syll
	nothing
	contour		f/+2:-3
	contour		f/+2:-2:+1
	nothing
>

První pravidlo "nothing" zde uvádí, e jednoslabièná slova
se neošetøují, koncové slovo "nothing" uvádí, e ètyø-
a víceslabièná slova se neošetøují. Pokud toti nadøazená
jednotka (úrovnì rozsahu) obsahuje více zasaenıch jednotek,
ne pro kolik je uvedeno pravidlo, pouije se poslední
uvedené pravidlo. Pokud by tedy koncové pravidlo "nothing"
chybìlo, pouilo by se pøedcházející pravidlo i pro delší
ne trojslabièné takty.

Jako u blokù a náhodnıch voleb, i zde je moné uvádìt,
kolikrát se má identické pravidlo poèítat. Upravíme-li
tedy pøedchozí pøíklad takto ---

<  word syll
	nothing
	contour		f/+2:-3
    2x	contour		f/+2:-2:+1
	nothing
>

--- pouije se druhé uvedené pravidlo "contour" pro slova
tøíslabièná a ètyøslabièná.

